SELECT P.CART_ID, IF(SUM(P.PRICE) < C.MINIMUM_REQUIREMENT AND C.DISCOUNT_AMOUNT > 0, 1, 0)
FROM CART_PRODUCTS P, COUPONS C
WHERE P.CART_ID = C.CART_ID
GROUP BY P.CART_ID;